<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JuniorReels | Kids Movies Worldwide</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Schoolbell&family=Snippet&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      :root {
        /* Define common sizes and transition speed */
        --transition-speed: 0.35s;
        --center-width: 1000px; /* Larger hero card width */
        --center-height: 620px; /* Larger hero card height */
        --side-scale: 0.8;
        --card-gap: 30px; /* Standard gap between cards */

        /* Derived values */
        --side-width: calc(var(--center-width) * var(--side-scale));
        --side-height: calc(var(--center-height) * var(--side-scale));
      }

      /* Reset / base */
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family: "Snippet", Arial, sans-serif;
        background: linear-gradient(135deg, #141e30 0%, #243b55 100%);
        overflow-x: hidden;
        color: #e6eef8;
      }

      /* Navigation Bar Styles */
      .navbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 28px;
        background: transparent;
      }
      .left {
        display: flex;
        align-items: center;
        gap: 20px;
      }
      h1 {
        font-family: "Schoolbell", cursive;
        font-size: 26px;
        color: aliceblue;
        margin: 0;
      }
      .navbar .right a {
        color: #d0d8e6;
        text-decoration: none;
        transition: color 0.15s;
        font-size: 14px;
      }
      .search {
        border: 1.5px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.02);
        color: #fff;
        width: 360px;
        max-width: 45vw;
        height: 36px;
        padding: 0 12px;
        border-radius: 8px;
        outline: none;
      }
      .right {
        display: flex;
        align-items: center;
        gap: 18px;
      }
      .profile {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #fff;
        border: 1.5px solid #fff;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .profile a i {
        color: #000 !important;
      }
      .settings {
        color: #fff;
        cursor: pointer;
      }

      /* MAIN CONTENT */
      .content {
        margin-top: 13px;
        padding-bottom: 40px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      /* CAROUSEL WRAPPER */
      .carousel-container {
        position: relative;
        width: 100%;
        max-width: 100vw;
        margin: 0 0 80px 0;
        overflow: hidden;
        min-height: calc(var(--center-height) + 50px);
        display: flex;
      }

      /* üåü CAROUSEL TRACK - The key to smooth transition */
      .carousel-track {
        display: flex;
        align-items: center;
        width: fit-content;
        /* FIX: Initial transform removed here. JS manages the entire transform state. */
        transition: transform var(--transition-speed) ease-out;
        will-change: transform;
      }

      /* Individual Movie Card Styling */
      .hero-card {
        flex-shrink: 0;
        width: var(--center-width);
        height: var(--center-height);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        display: flex;
        align-items: flex-end;
        color: white;
        background-size: cover;
        background-position: center;
        border: 5px solid rgba(241, 241, 241, 0.08);
        margin-right: var(--card-gap);

        transition: opacity var(--transition-speed) ease-out,
          width var(--transition-speed) ease-out,
          height var(--transition-speed) ease-out, box-shadow 0.3s;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
        cursor: default;
      }

      /* Remove margin from the last card in the 3-card set */
      .carousel-track > :last-child {
        margin-right: 0;
      }

      /* Anchor for center card - FIX: Ensure it covers the area and removes underline */
      .center-card-link {
        text-decoration: none; /* FIX: Removes underline */
        color: inherit;
        cursor: pointer;
        display: block; /* FIX: Ensure the link takes up the full space */
        position: relative; /* Ensure z-index works */
        z-index: 10;
      }

      /* Side card */
      .hero-card.side-card {
        transform: scale(var(--side-scale));
        opacity: 0.6;
        width: var(--side-width);
        height: var(--side-height);
        cursor: pointer;
      }

      /* Overwrite margin for center card link wrapper */
      .center-card-link {
        margin-right: var(--card-gap);
      }

      /* ... (Content styles remain unchanged) ... */

      .hero-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.6) 0%,
          rgba(0, 0, 0, 0.18) 40%,
          rgba(0, 0, 0, 0.02) 100%
        );
        pointer-events: none;
      }

      .hero-content {
        padding: 20px 32px 30px 30px;
        position: relative;
        width: 100%;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        z-index: 2;
      }

      .hero-content h2 {
        font-size: 48px;
        margin: 0;
        font-family: "Bebas Neue", sans-serif;
        letter-spacing: 2px;
        text-shadow: 0 0 8px rgba(0, 0, 0, 0.9);
        word-break: break-word;
        white-space: normal;
        line-height: 1.05;
      }

      .hero-content .rating-info {
        font-family: "Snippet", sans-serif;
        font-size: 18px;
        margin-top: 6px;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
      }

      .is-animating * {
        pointer-events: none;
      }

      footer {
        width: 100%;
        box-sizing: border-box;
        text-align: center;
        padding: 18px 0;
        font-size: 14px;
        color: #cbd6e6;
        border-top: 1px solid rgba(255, 255, 255, 0.03);
      }

      /* Responsiveness (adjusted to use new variables) */
      @media (max-width: 1200px) {
        :root {
          --center-width: 640px;
          --center-height: 400px;
        }
      }
      @media (max-width: 760px) {
        :root {
          --center-width: 360px;
          --center-height: 220px;
          --side-scale: 0.72;
          --card-gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="navbar" role="navigation" aria-label="Primary navigation">
      <div class="left">
        <h1>Jr. Reels</h1>
        <input
          type="text"
          class="search"
          placeholder="Search for cartoons"
          aria-label="Search cartoons"
        />
      </div>

      <div class="right">
        <a
          href="C:\xampp\htdocs\studentapp\login\cat.html"
          aria-label="Categories"
          >Categories</a
        >
        <a href="#" aria-label="My favorites">My Favorites</a>
        <div class="profile" title="Profile">
          <a href="log.html" aria-label="Profile"
            ><i class="fa-solid fa-user"></i
          ></a>
        </div>
        <i
          class="fa-solid fa-gear settings"
          title="Settings"
          aria-hidden="true"
        ></i>
      </div>
    </div>

    <div class="content">
      <div id="carouselContainer" class="carousel-container" aria-live="polite">
        <div id="carouselTrack" class="carousel-track" role="list">
          <div id="loadingText" class="loading-text">
            Loading awesome movies...
          </div>
        </div>
      </div>

      <footer>¬© 2025 JuniorReels | Safe Entertainment for Kids ‚ù§Ô∏è</footer>
    </div>
    <script>
      const API_KEY = "038650abc5be23d9cb8e9f4803b5e2c9"; // your TMDb key
      const carouselContainer = document.getElementById("carouselContainer");
      const carouselTrack = document.getElementById("carouselTrack");
      const loadingText = document.getElementById("loadingText");
      const IMAGE_BASE_URL = "https://image.tmdb.org/t/p/w1280";
      const MAX_FILMS = 15;
      const ANIMATION_DURATION_MS = 350;
      const searchInput = document.querySelector(".search"); // ‚úÖ added

      let SLIDE_DISTANCE = 0;
      let CENTER_OFFSET_PX = 0;
      let currentOffset = 0;
      let moviesData = [];
      let currentIndex = 0;
      let isAnimating = false;

      const getCssVariable = (name, fallback = 0) => {
        try {
          const raw = getComputedStyle(document.documentElement)
            .getPropertyValue(name)
            .trim();
          const v = parseFloat(raw.replace("px", ""));
          return Number.isFinite(v) ? v : fallback;
        } catch (e) {
          return fallback;
        }
      };

      function updateCardDimensions() {
        const sideWidth = getCssVariable("--side-width", 800);
        const centerWidth = getCssVariable("--center-width", 1000);
        const cardGap = getCssVariable("--card-gap", 30);
        SLIDE_DISTANCE = sideWidth + cardGap;
        CENTER_OFFSET_PX = sideWidth + cardGap + centerWidth / 2;
      }

      function escapeHtml(str = "") {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function getCircularMovie(index) {
        if (!moviesData.length) return null;
        const len = moviesData.length;
        return moviesData[((index % len) + len) % len];
      }

      function createMovieCard(movie, isCenter = false, indexInData = 0) {
        const card = document.createElement("div");
        card.className = "hero-card";
        if (!isCenter) card.classList.add("side-card");

        card.dataset.movieIndex = indexInData;

        const year = movie.release_date
          ? movie.release_date.substring(0, 4)
          : "N/A";
        const voteAverage = movie.vote_average
          ? movie.vote_average.toFixed(1)
          : "N/A";
        const voteCount = movie.vote_count
          ? movie.vote_count.toLocaleString()
          : "N/A";
        const imageUrl = `${IMAGE_BASE_URL}${movie.backdrop_path}`;

        let titleHtml = `<h2>${escapeHtml(movie.title)}</h2>`;

        card.style.backgroundImage = `url('${imageUrl}')`;
        card.innerHTML = `
      <div class="hero-overlay"></div>
      <div class="hero-content">
        ${titleHtml}
        <p class="rating-info">‚≠ê ${voteAverage}/10 (${voteCount} votes) | ${year}</p>
      </div>
    `;

        if (!isCenter) {
          card.addEventListener("click", () => {
            if (isAnimating || moviesData.length === 0) return;
            const clickedIndex = Number(card.dataset.movieIndex);
            const diff = clickedIndex - currentIndex;
            let direction;
            const numMovies = moviesData.length;
            if (Math.abs(diff) <= numMovies / 2) {
              direction = diff;
            } else {
              direction = diff > 0 ? diff - numMovies : diff + numMovies;
            }
            changeMovie(direction);
          });
        }

        if (isCenter) {
          const link = document.createElement("a");
          link.href = `movies.html?id=${movie.id}`;
          link.className = "center-card-link";
          link.appendChild(card);
          return link;
        }

        return card;
      }

      function renderCarousel() {
        updateCardDimensions();
        carouselTrack.innerHTML = "";

        const prevMovie = getCircularMovie(currentIndex - 1);
        const currentMovie = getCircularMovie(currentIndex);
        const nextMovie = getCircularMovie(currentIndex + 1);

        if (!currentMovie) return;

        const len = moviesData.length;

        carouselTrack.appendChild(
          createMovieCard(prevMovie, false, (currentIndex - 1 + len) % len)
        );
        carouselTrack.appendChild(
          createMovieCard(currentMovie, true, currentIndex)
        );
        carouselTrack.appendChild(
          createMovieCard(nextMovie, false, (currentIndex + 1) % len)
        );

        carouselTrack.style.transform = `translateX(calc(50% - ${CENTER_OFFSET_PX}px))`;
      }

      function changeMovie(direction) {
        if (isAnimating || moviesData.length === 0) return;
        isAnimating = true;
        carouselContainer.classList.add("is-animating");

        currentOffset -= SLIDE_DISTANCE * direction;
        carouselTrack.style.transition = `transform var(--transition-speed) ease-in-out`;
        carouselTrack.style.transform = `translateX(calc(50% - ${
          CENTER_OFFSET_PX - currentOffset
        }px))`;

        setTimeout(() => {
          const numMovies = moviesData.length;
          let steps = Math.sign(direction);
          currentIndex = (currentIndex + steps + numMovies) % numMovies;
          currentOffset = 0;
          carouselTrack.style.transition = "none";
          isAnimating = false;
          carouselContainer.classList.remove("is-animating");
          renderCarousel();
        }, ANIMATION_DURATION_MS + 20);
      }

      // ----------------------
      // üß† Search functionality
      // ----------------------
      async function searchMovies(query) {
        if (!query.trim()) {
          loadKidMoviesTMDb(); // If input is empty, reload main feed
          return;
        }

        loadingText.textContent = `Searching for ‚Äú${query}‚Äù...`;
        carouselTrack.innerHTML = "";
        carouselTrack.appendChild(loadingText);

        const url = `https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&language=en-US&query=${encodeURIComponent(
          query
        )}&include_adult=false`;

        try {
          const res = await fetch(url);
          const data = await res.json();
          const filtered = (data.results || [])
            .filter(
              (m) =>
                m.backdrop_path &&
                m.title &&
                (m.genre_ids.includes(16) || m.genre_ids.includes(10751))
            )
            .slice(0, MAX_FILMS);

          if (filtered.length === 0) {
            loadingText.textContent = `No family or animated movies found for ‚Äú${query}‚Äù.`;
            return;
          }

          moviesData = filtered;
          currentIndex = 0;
          loadingText.remove();
          renderCarousel();
        } catch (err) {
          console.error("Search Error:", err);
          loadingText.textContent = "Error fetching search results.";
        }
      }

      // üîç Listen for Enter key in search input
      searchInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          searchMovies(searchInput.value);
        }
      });

      // ----------------------
      // Load default kids/animated movies
      // ----------------------
      async function loadKidMoviesTMDb() {
        if (loadingText) loadingText.textContent = "Loading awesome movies...";

        const url = `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=en-US&sort_by=primary_release_date.desc&with_genres=16,10751&vote_count.gte=100&certification_country=US&certification=G|PG&page=1`;

        try {
          updateCardDimensions();
          const res = await fetch(url);
          const data = await res.json();
          moviesData = (data.results || [])
            .filter((m) => m && m.backdrop_path && m.title)
            .slice(0, MAX_FILMS);

          if (moviesData.length > 0) {
            if (loadingText) loadingText.remove();
            currentIndex = 0;
            renderCarousel();
          } else {
            if (loadingText)
              loadingText.textContent =
                "No popular recent animated/family films found.";
          }
        } catch (e) {
          if (loadingText)
            loadingText.textContent = "Network error during fetch.";
          console.error("TMDb Fetch Error:", e);
        }
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") changeMovie(1);
        else if (e.key === "ArrowLeft") changeMovie(-1);
      });

      carouselContainer.addEventListener("touchstart", (e) => {
        if (isAnimating || moviesData.length === 0) return;
        touchStartX = e.touches[0].screenX;
        carouselTrack.style.transition = "none";
      });
      carouselContainer.addEventListener("touchmove", (e) => {
        if (!touchStartX) return;
        const deltaX = e.touches[0].screenX - touchStartX;
        carouselTrack.style.transform = `translateX(calc(50% - ${
          CENTER_OFFSET_PX - deltaX
        }px))`;
      });
      carouselContainer.addEventListener("touchend", (e) => {
        const deltaX = e.changedTouches[0].screenX - touchStartX;
        if (Math.abs(deltaX) > 70) {
          if (deltaX < 0) changeMovie(1);
          else changeMovie(-1);
        } else renderCarousel();
        touchStartX = 0;
      });

      loadKidMoviesTMDb();
    </script>
  </body>
</html>
